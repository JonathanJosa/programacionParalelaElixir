<style> pre{background-color: #292F36;} </style><file name='watcher.ex'ubicacion='media/shared/partner1/exec/watcher.ex'><pre><code> <span style='color:#C19875'> ·</span> <span style='color:#1098F7;'>defmodule</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>Watcher</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>use</span> <span style='color:#FBFBFF;'>GenServer</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>def</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>start</span><span style='color:#9A8BBB;'>_</span><span style='color:#9A8BBB;'>link</span><span style='color:#9A8BBB;'>(</span><span style='color:#9A8BBB;'>)</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#D7B884;'>GenServer.</span><span style='color:#FBFBFF;'>start</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>link</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>MODULE</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>dirs:</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>lib</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>koans</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>def</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>init</span><span style='color:#9A8BBB;'>(</span><span style='color:#03DDB2;'>args</span><span style='color:#9A8BBB;'>)</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:ok</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>watcher</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>pid</span><span style='color:#FBFBFF;'>}</span> <span style='color:#1098F7;'>=</span> <span style='color:#D7B884;'>FileSystem.</span><span style='color:#FBFBFF;'>start</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>link</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>args</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#D7B884;'>FileSystem.</span><span style='color:#FBFBFF;'>subscribe</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>watcher</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>pid</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:ok</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>%</span><span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>watcher</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>pid:</span> <span style='color:#FBFBFF;'>watcher</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>pid</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>}</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>def</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>handle</span><span style='color:#9A8BBB;'>_</span><span style='color:#9A8BBB;'>info</span><span style='color:#9A8BBB;'>(</span><span style='color:#03DDB2;'>{</span><span style='color:#EAC435;'>:file</span><span style='color:#03DDB2;'>_</span><span style='color:#03DDB2;'>event</span><span style='color:#9A8BBB;'>,</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>watcher</span><span style='color:#03DDB2;'>_</span><span style='color:#03DDB2;'>pid</span><span style='color:#9A8BBB;'>,</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>{</span><span style='color:#03DDB2;'>path</span><span style='color:#9A8BBB;'>,</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>events</span><span style='color:#03DDB2;'>}</span><span style='color:#03DDB2;'>}</span><span style='color:#9A8BBB;'>,</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>%</span><span style='color:#03DDB2;'>{</span><span style='color:#03DDB2;'>watcher</span><span style='color:#03DDB2;'>_</span><span style='color:#03DDB2;'>pid:</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>watcher</span><span style='color:#03DDB2;'>_</span><span style='color:#03DDB2;'>pid</span><span style='color:#03DDB2;'>}</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>=</span><span style='color:#03DDB2;'> </span><span style='color:#03DDB2;'>state</span><span style='color:#9A8BBB;'>)</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#565857;'><i># respond to renamed as well due to that some editors use temporary files for atomic writes </i></span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>ex:</span> <span style='color:#FBFBFF;'>TextMate</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>if</span> <span style='color:#D7B884;'>Enum.</span><span style='color:#FBFBFF;'>member?</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>events</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:modified</i></span><span style='color:#FBFBFF;'>)</span> <span style='color:#FBFBFF;'>|</span><span style='color:#FBFBFF;'>|</span> <span style='color:#D7B884;'>Enum.</span><span style='color:#FBFBFF;'>member?</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>events</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:renamed</i></span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#FBFBFF;'>path</span> <span style='color:#B80C09;'>|></span> <span style='color:#FBFBFF;'>normalize</span> <span style='color:#B80C09;'>|></span> <span style='color:#FBFBFF;'>reload</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>       <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:noreply</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>state</span><span style='color:#FBFBFF;'>}</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#FBFBFF;'>defp</span> <span style='color:#FBFBFF;'>reload</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>if</span> <span style='color:#D7B884;'>Path.</span><span style='color:#FBFBFF;'>extname</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>ex</span><span style='color:#FBFBFF;'>"</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#FBFBFF;'>try</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#FBFBFF;'>file</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#B80C09;'>|></span> <span style='color:#FBFBFF;'>portable</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>load</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#B80C09;'>|></span> <span style='color:#D7B884;'>Enum.</span><span style='color:#FBFBFF;'>map</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>&</span><span style='color:#FBFBFF;'>elem</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>&</span><span style='color:#FBFBFF;'>1</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>0</span><span style='color:#FBFBFF;'>)</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#B80C09;'>|></span> <span style='color:#D7B884;'>Enum.</span><span style='color:#FBFBFF;'>find</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>&</span><span style='color:#D7B884;'>Runner.</span><span style='color:#FBFBFF;'>koan?</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>1</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#B80C09;'>|></span> <span style='color:#D7B884;'>Runner.</span><span style='color:#FBFBFF;'>modules</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>to</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>run</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#B80C09;'>|></span> <span style='color:#D7B884;'>Runner.</span><span style='color:#FBFBFF;'>run</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#FBFBFF;'>rescue</span>
 <span style='color:#C19875'> ·</span>           <span style='color:#FBFBFF;'>e</span> <span style='color:#1098F7;'>-</span><span style='color:#1098F7;'>></span> <span style='color:#D7B884;'>Display.</span><span style='color:#FBFBFF;'>show</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>compile</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>error</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>e</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#565857;'><i># Elixir 1.7 deprecates Code.load</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span> <span style='color:#FBFBFF;'>in</span> <span style='color:#FBFBFF;'>favor</span> <span style='color:#FBFBFF;'>of</span> <span style='color:#D7B884;'>Code.</span><span style='color:#FBFBFF;'>compile</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>.</span> <span style='color:#FBFBFF;'>In</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#565857;'><i># order to avoid the depecation warnings while maintaining backwards</i></span>
 <span style='color:#C19875'> ·</span>     <span style='color:#565857;'><i># compatibility, we check the sytem version and execute conditionally.</i></span>
 <span style='color:#C19875'> ·</span>     <span style='color:#FBFBFF;'>defp</span> <span style='color:#FBFBFF;'>portable</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>load</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>if</span> <span style='color:#D7B884;'>Version.</span><span style='color:#FBFBFF;'>match?</span><span style='color:#FBFBFF;'>(</span><span style='color:#D7B884;'>System.</span><span style='color:#FBFBFF;'>version</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>)</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>~</span><span style='color:#1098F7;'>></span> <span style='color:#FBFBFF;'>1</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>7</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#D7B884;'>Code.</span><span style='color:#FBFBFF;'>compile</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>else</span>
 <span style='color:#C19875'> ·</span>         <span style='color:#D7B884;'>Code.</span><span style='color:#FBFBFF;'>load</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   
 <span style='color:#C19875'> ·</span>     <span style='color:#FBFBFF;'>defp</span> <span style='color:#FBFBFF;'>normalize</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>)</span> <span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>       <span style='color:#D7B884;'>String.</span><span style='color:#FBFBFF;'>replace</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>suffix</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>jb</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>tmp</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>end</span></code></pre><br></file>