<style> pre{background-color: #292F36;} </style><file name='supervisor.ex'ubicacion='media/shared/partner1/supervisor.ex'><pre><code> <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># The goal here is to learn </i></span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>a</span> <span style='color:#FBFBFF;'>tiny</span> <span style='color:#FBFBFF;'>bit</span><span style='color:#FBFBFF;'>)</span> <span style='color:#FBFBFF;'>about</span> <span style='color:#FBFBFF;'>the</span> <span style='color:#FBFBFF;'>Supervisor</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># We simply fire up the server from exercise 18 and restart it on failure.</i></span>
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span> <span style='color:#D7B884;'>Code.</span><span style='color:#FBFBFF;'>load</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>file</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>18</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>gen</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>exs</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span> <span style='color:#1098F7;'>defmodule</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>PrimeFactorsServer.</span><span style='color:#9A8BBB;'>Sup</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>use</span> <span style='color:#FBFBFF;'>Supervisor</span>
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>def</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>start</span><span style='color:#9A8BBB;'>_</span><span style='color:#9A8BBB;'>link</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#EAC435;'><i>:supervisor</i></span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>start</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>link</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>MODULE</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>def</span><span style='color:#9A8BBB;'> </span><span style='color:#9A8BBB;'>init</span><span style='color:#9A8BBB;'>(</span><span style='color:#03DDB2;'>_</span><span style='color:#03DDB2;'>opts</span><span style='color:#9A8BBB;'>)</span><span style='color:#9A8BBB;'> </span><span style='color:#1098F7;'>do</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#FBFBFF;'>tree</span> <span style='color:#1098F7;'>=</span> <span style='color:#FBFBFF;'>[</span> <span style='color:#FBFBFF;'>worker</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>PrimeFactorsServer</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>)</span> <span style='color:#FBFBFF;'>]</span>
 <span style='color:#C19875'> ·</span>     <span style='color:#FBFBFF;'>supervise</span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>tree</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>strategy:</span> <span style='color:#EAC435;'><i>:one</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>for</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>one</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span>   <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span> <span style='color:#1098F7;'>end</span>
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span> 
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># to use</i></span><span style='color:#1098F7;'>:</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># iex 19-supervisor.exs</i></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># iex</i></span><span style='color:#1098F7;'>></span> <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:ok</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>pid</span><span style='color:#FBFBFF;'>}</span> <span style='color:#1098F7;'>=</span> <span style='color:#D7B884;'>PrimeFactorsServer.</span><span style='color:#D7B884;'>Sup.</span><span style='color:#FBFBFF;'>start</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>link</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i>#</i></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># iex</i></span><span style='color:#1098F7;'>></span> <span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>call</span><span style='color:#FBFBFF;'>(</span><span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>100</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># </i></span><span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>5</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>5</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>2</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>2</span><span style='color:#FBFBFF;'>]</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i>#</i></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># iex</i></span><span style='color:#1098F7;'>></span> <span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>call</span><span style='color:#FBFBFF;'>(</span><span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>a</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># </i></span><span style='color:#1098F7;'>=</span><span style='color:#FBFBFF;'>ERROR</span> <span style='color:#FBFBFF;'>REPORT</span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span> <span style='color:#FBFBFF;'>30</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>Dec</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>2013</span><span style='color:#1098F7;'>:</span><span style='color:#EAC435;'><i>:22</i></span><span style='color:#EAC435;'><i>:54</i></span><span style='color:#EAC435;'><i>:42</i></span> <span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** Generic server prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span> <span style='color:#FBFBFF;'>terminating</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** Last message in was </i></span><span style='color:#1098F7;'><</span><span style='color:#1098F7;'><</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>a</span><span style='color:#FBFBFF;'>"</span><span style='color:#1098F7;'>></span><span style='color:#1098F7;'>></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** When Server state </i></span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>]</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** Reason for termination </i></span><span style='color:#1098F7;'>=</span><span style='color:#1098F7;'>=</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** </i></span><span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>badarg</span><span style='color:#FBFBFF;'>,</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ...</i></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># ** </i></span><span style='color:#FBFBFF;'>(</span><span style='color:#FBFBFF;'>exit</span><span style='color:#FBFBFF;'>)</span> <span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:badarg</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:math</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:sqrt</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>a</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>PrimeFactors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>?</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>1</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>file:</span> <span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>tim</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>pp</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>30</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>days</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>of</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>elixir</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>18</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>gen</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>exs</span><span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>line:</span> <span style='color:#FBFBFF;'>16</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>PrimeFactors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>3</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>file:</span> <span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>tim</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>pp</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>30</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>days</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>of</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>elixir</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>18</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>gen</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>exs</span><span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>line:</span> <span style='color:#FBFBFF;'>4</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#FBFBFF;'>PrimeFactorsServer</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:handle</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>call</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>3</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>file:</span> <span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>tim</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>pp</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>30</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>days</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>of</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>elixir</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>18</span><span style='color:#1098F7;'>-</span><span style='color:#FBFBFF;'>gen</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>exs</span><span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>line:</span> <span style='color:#FBFBFF;'>49</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:handle</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>msg</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>5</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>file:</span> <span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>gen</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>erl</span><span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>line:</span> <span style='color:#FBFBFF;'>585</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:proc</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>lib</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:init</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>p</span><span style='color:#FBFBFF;'>_</span><span style='color:#1098F7;'>do</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>apply</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>3</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>file:</span> <span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>proc</span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>lib</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>erl</span><span style='color:#FBFBFF;'>'</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>line:</span> <span style='color:#FBFBFF;'>239</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>{</span><span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>,</span> <span style='color:#EAC435;'><i>:call</i></span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>[</span><span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>a</span><span style='color:#FBFBFF;'>"</span><span style='color:#FBFBFF;'>]</span><span style='color:#FBFBFF;'>}</span><span style='color:#FBFBFF;'>}</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i>#     gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>erl:180:</span> <span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>call</span><span style='color:#FBFBFF;'>/</span><span style='color:#FBFBFF;'>2</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i>#</i></span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># iex</i></span><span style='color:#1098F7;'>></span> <span style='color:#EAC435;'><i>:gen</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>server</span><span style='color:#FBFBFF;'>.</span><span style='color:#FBFBFF;'>call</span><span style='color:#FBFBFF;'>(</span><span style='color:#EAC435;'><i>:prime</i></span><span style='color:#FBFBFF;'>_</span><span style='color:#FBFBFF;'>factors</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>8</span><span style='color:#FBFBFF;'>)</span>
 <span style='color:#C19875'> ·</span> <span style='color:#565857;'><i># </i></span><span style='color:#FBFBFF;'>[</span><span style='color:#FBFBFF;'>2</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>2</span><span style='color:#FBFBFF;'>,</span> <span style='color:#FBFBFF;'>2</span><span style='color:#FBFBFF;'>]</span>
 <span style='color:#C19875'> ·</span> </code></pre><br></file>